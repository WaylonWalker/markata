<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>{{ feed.config.title }}</title>
  <id>{{ markata.config.url }}/{{ feed.config.slug }}/</id>

  <link href="{{ markata.config.url }}/{{ feed.config.slug }}/atom.xml" rel="self" />
  <link href="{{ markata.config.url }}/" rel="alternate" />

  {# Feed-level updated (Atom likes this) #}
  {% set updated_post = feed.posts[0] if feed.posts else None %}
  {% if updated_post and updated_post.date %}
  <updated>{{ updated_post.date.isoformat() }}Z</updated>
  {% else %}
  <updated>{{ datetime.datetime.utcnow().isoformat() }}Z</updated>
  {% endif %}

  {% for post in feed.posts %}
  <entry>
    <title>{{ post.title }}</title>
    <id>{{ markata.config.url }}/{{ post.slug }}/</id>
    <link href="{{ markata.config.url }}/{{ post.slug }}/" rel="alternate" />

    {% if post.date %}
    <updated>{{ post.date.isoformat() }}Z</updated>
    <published>{{ post.date.isoformat() }}Z</published>
    {% endif %}

    {% if post.description %}
    <summary type="html"><![CDATA[
{{ post.description }}
    ]]></summary>
    {% endif %}

    {% if post.content %}
    <content type="html"><![CDATA[
{{ post.content }}
    ]]></content>
    {% endif %}
  </entry>
  {% endfor %}
</feed>

